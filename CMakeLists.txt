CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(FreeFem++ C CXX Fortran)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/cmake/modules)

INCLUDE(ProcessorCount)
ProcessorCount(N)
IF(NOT N EQUAL 0)
  SET(CMAKE_BUILD_FLAGS -j${N})
ENDIF()

######################
# C++ COMPILER OPTIONS
######################

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fPIC")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC -DBAMG_LONG_LONG")
IF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DHAVE_UNISTD_H" )
ENDIF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")

IF(CMAKE_BUILD_TYPE EQUAL "Debug")
    SET(CMAKE_CXX_FLAGS "${FF_CXX_FLAGS} -DCHECK_KN -g" )
    IF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
        SET(CMAKE_CXX_FLAGS "${FF_CXX_FLAGS} -fno-inline -fexceptions" )
    ENDIF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
ELSE()
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DNCHECKPTR -O3" )
ENDIF(CMAKE_BUILD_TYPE EQUAL "Debug")

FILE(GLOB FEMLIB_SRC src/femlib/*.cpp)
FILE(GLOB_RECURSE FFLIB_SRC src/fflib/*.cpp)

###########
# DOWNLOAD
##########

INCLUDE(FFInstallPackage)

#FF_INSTALL_PACKAGE(MMG3D)
#FF_INSTALL_PACKAGE(Scalapack)
#FF_INSTALL_PACKAGE(Scotch)
#FF_INSTALL_PACKAGE(FFTW)

#FILE(DOWNLOAD http://crd-legacy.lbl.gov/~xiaoye/SuperLU/superlu_4.3.tar.gz 
#              mydownload/superlu_4.3.tar.gz
#              SHOW_PROGRESS)

ADD_SUBDIRECTORY(src)
ADD_SUBDIRECTORY(examples++-load)
